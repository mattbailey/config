let mapleader=","

source $HOME/.config/vim/watch-for-changes.vim

"""""""""""""""""""" GLOBAL
filetype plugin indent on
set autoread
set nostartofline
set scrolloff=8
set ttyfast
set background=dark
set relativenumber
set number
set mouse=a
syntax on
set encoding=utf-8
set hidden
" set nowrap
set breakindent
set backspace=indent,eol,start
set autoindent
set copyindent
set number
set shiftround
set ignorecase
set smartcase
set hlsearch
set incsearch
set history=1000
set undolevels=1000
set wildignore=*.swp,*.bak
set title
set visualbell
set noerrorbells
set listchars=tab:▸\ ,trail:⊗,nbsp:▹,eol:¬
set list
set nocompatible
set backup
set backupdir=$HOME/.cache/vim
set noswapfile
set fileformats=unix,dos,mac
set laststatus=2
set expandtab
set softtabstop=2 tabstop=2 shiftwidth=2
set ruler
set clipboard=unnamed
set termguicolors

"let loaded_matchparen=1 " Don't load matchit.vim (paren/bracket matching)
"set noshowmatch         " Don't match parentheses/brackets
set nocursorline        " Don't paint cursor line
set nocursorcolumn      " Don't paint cursor column
set lazyredraw          " Wait to redraw
"let html_no_rendering=1 " Don't render italic, bold, links in HTML

let $NVIM_TUI_ENABLE_TRUE_COLOR=1
set background=dark

"""""""""""""""""""" NEOBUNDLE
source $HOME/.config/vim/autoload/plug.vim

if filereadable($HOME . "/.config/vim/plugins.vim")
  source $HOME/.config/vim/plugins.vim
endif

" Make Columns stand out
highlight ColorColumn ctermbg=200
call matchadd('ColorColumn', '\%101v', 100)
set fillchars=vert:┃,fold:━
highlight VertSplit cterm=none ctermbg=none ctermfg=247

"""""""""""""""""""" FILES SPECIFIC

nnoremap <leader>b :%!xxd<CR>

""""""""""""""" pastetoggle
" set pastetoggle=<F3>
map <F3> :set paste!<CR>

"Remove indenting on empty lines
map <F2> :%s/\s*$//g<cr>:noh<cr>''

nmap j gj
nmap k gk

cnoremap <C-a>  <Home>

set incsearch
set ignorecase
set smartcase
set hlsearch
nmap \q :nohlsearch<CR>

nmap <C-e> :e#<CR>

set showcmd

cmap \W !sudo tee % >/dev/null<CR>

" Colorpicker (only for mac)
inoremap <C-C> <C-R>=system('color-picker')<CR>

"""""""""""""""""""" KEYBINDINGS

map cc <leader>c<space>
map  <F6> :setlocal spell! spelllang=en<CR>
map  <F12> :set invhls<CR>
cmap <C-g> <C-u><ESC>
command! -bang W w<bang>
nnoremap <C-n> :bn<CR>
nnoremap <C-p> :bp<CR>
nnoremap q <c-v>

" Make Ctrl-e jump to the end of the current line in the insert mode. This is
" handy when you are in the middle of a line and would like to go to its end
" without switching to the normal mode.
inoremap <C-e> <C-o>$

" Stay in visual mode when indenting. You will never have to run gv after
" performing an indentation.
vnoremap < <gv
vnoremap > >gv

" Quickly select the text that was just pasted. This allows you to, e.g.,
" indent it after pasting.
noremap gV `[v`]

""""""""""""""""""" Tab completion
function! Inserttabwrapper()
    let col = col('.') - 1
    if !col || getline('.')[col - 1] !~ '\k'
        return "\<tab>"
    else
        return "\<c-p>"
    endif
endfunction

" Map <tab> to Inserttabwarpper()
inoremap <tab> <c-r>=Inserttabwrapper()<cr>

" Shift tab to backwards search
inoremap <s-tab> <c-n>

""""""""""""""""""" Strip bad whitespace
function! <SID>StripTrailingWhitespace()
    " Preparation: save last search, and cursor position.
    let _s=@/
    let l = line(".")
    let c = col(".")
    " Do the business:
    %s/\s\+$//e
    " Clean up: restore previous search history, and cursor position
    let @/=_s
    call cursor(l, c)
endfunction
nmap <Leader><space> :call <SID>StripTrailingWhitespace()<CR>

" RAML
autocmd! BufNewFile,BufRead *.raml set filetype=yaml

com! FormatJSON %!jq -S .

" THEME
"colorscheme gotham256
"let g:airline_theme='gotham256'
let g:gruvbox_italic=1
let g:gruvbox_italicize_comments=1
let g:gruvbox_italicize_strings=1
colorscheme nova
set background=dark

"hi NonText ctermfg=59 ctermbg=235 cterm=NONE guifg=#525563 guibg=#282a36 gui=NONE "line endings
hi SpecialKey ctermfg=59 ctermbg=235 cterm=NONE guifg=#525563 guibg=#282a36 gui=NONE
hi Visual ctermbg=23 cterm=NONE
hi Special cterm=italic gui=italic
hi javaScriptFunction cterm=italic gui=italic
hi javascriptFuncKeyword ctermfg=117 ctermbg=NONE cterm=italic guifg=#8be9fd guibg=NONE gui=italic
hi Identifier ctermfg=117 ctermbg=NONE cterm=italic guifg=#8be9fd guibg=NONE gui=italic
hi StorageClass ctermfg=117 ctermbg=NONE cterm=NONE guifg=#8be9fd guibg=NONE gui=italic
hi rubyConstant ctermfg=81 ctermbg=NONE cterm=NONE guifg=#66d9ef guibg=NONE gui=italic
hi rubyBlockParameter ctermfg=215 ctermbg=NONE cterm=NONE guifg=#ffb86c guibg=NONE gui=italic
hi rubyRailsUserClass ctermfg=81 ctermbg=NONE cterm=NONE guifg=#66d9ef guibg=NONE gui=italic
hi cssURL ctermfg=215 ctermbg=NONE cterm=NONE guifg=#ffb86c guibg=NONE gui=italic
hi Comment cterm=italic gui=italic
hi Conceal ctermfg=200 guibg=200
" END THEME
"
au FileType xml exe ":silent %!xmllint --format --recover - 2>/dev/null"

